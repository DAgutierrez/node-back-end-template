var root;

var translate = function(filePath, expressRouter) {
  // remove slashs from beginning
  filePath = filePath.replace(/^\/+/g, '');

  var routesObj = require(root+filePath+'.js'),
    action, route, params, mids;

  for (action in routesObj) {
    if (routesObj.hasOwnProperty(action)) {
      route = routesObj[action];

      // check properties
      if (typeof route.path !== 'string') throw 'path must be a string.';
      if (typeof route.verb !== 'string') throw 'verb must be a string.';
      if (typeof route.fn !== 'function') throw 'fn must be a function.';

      // middlewares e funcão principal (valor padrão)
      mids = route.fn;

      // caso mids exista, modifica o valor de mids para
      // mids + função principal
      if (route.mids)
        mids = route.mids.concat(route.fn);

      // cria os params (array) para função apply do js
      params = [route.path].concat(mids);

      // chama a função correta do expressRouter de acordo com o
      // verbo e passa os params computados
      expressRouter[route.verb].apply(expressRouter, params);
    }
  }

  return expressRouter;
}

module.exports = function(rootPath) {
 root = (rootPath.substring(rootPath.length-1) === '/')
  ? rootPath.replace(/\/{2,}$/g, '/')
  : rootPath + '/';

 return translate;
};
